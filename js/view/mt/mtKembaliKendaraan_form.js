jun.MtPengembalianWin=Ext.extend(Ext.Window,{title:"Pengembalian Kendaraan",modez:1,id:"mt-win-pengembalian",width:900,height:590,layout:"form",modal:!0,padding:5,closeForm:!1,resizable:!1,iswin:!0,initComponent:function(){this.items=[{xtype:"form",frame:!1,bodyStyle:"background-color: #E4E4E4; padding: 10px",id:"from-MtPengembalianWin",labelWidth:100,labelAlign:"left",layout:"absolute",ref:"formz",anchor:"100% 100%",border:!1,items:[{xtype:"hidden",name:"id_pinjam"},{xtype:"label",text:"No. Pinjam",x:5,y:5},{xtype:"textfield",hideLabel:!1,name:"doc_ref",id:"doc_refid",readOnly:!0,ref:"../doc_ref",x:100,y:2,height:20,width:200},{xtype:"label",text:"Nama Konsumen",x:5,y:35},{xtype:"combo",typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",allowBlank:!1,forceSelection:!0,lastQuery:"",store:jun.rztMtPelanggan,hiddenName:"id_pelanggan",hiddenValue:"id_pelanggan",valueField:"id_pelanggan",displayField:"nama",readOnly:!0,x:100,y:32,height:20,width:200},{xtype:"label",text:"Tanda Pengenal",x:5,y:65},new jun.comboTandaPengenal({allowBlank:!1,value:"KTP",name:"tanda_pengenal",readOnly:!0,x:100,y:62,height:20,width:200}),{xtype:"label",text:"No. Kembali",x:540,y:5},{xtype:"textfield",hideLabel:!1,name:"doc_ref_kembali",id:"doc_ref_kembaliid",readOnly:!0,ref:"../doc_ref_kembali",x:660,y:2,height:20,width:200},{xtype:"label",text:"Tanggal Transaksi",x:540,y:35},{xtype:"xdatefield",ref:"../trans_date",fieldLabel:"trans_date",name:"trans_date",id:"trans_dateid",format:"d M Y",allowBlank:!1,x:660,y:32,height:20,width:200},{xtype:"label",text:"Kelompok Konsumen",x:540,y:65},{xtype:"combo",typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",allowBlank:!1,forceSelection:!0,store:jun.rztMtKelompokPelanggan,hiddenName:"id_kelompok",hiddenValue:"id_kelompok",valueField:"id_kelompok",displayField:"nama",ref:"../id_kelompok",lastQuery:"",readOnly:!0,x:660,y:62,height:20,width:200},{xtype:"label",text:"No. Identitas",x:540,y:95},{xtype:"textfield",hideLabel:!1,allowBlank:!1,name:"no_identitas",id:"no_identitasid",ref:"../no_identitas",maxLength:30,readOnly:!0,x:660,y:92,height:20,width:200},{xtype:"label",text:"Jaminan:",x:5,y:95},new jun.cmbJaminan({allowBlank:!1,value:"Kartu Keluarga",name:"jaminan",readOnly:!0,x:100,y:92,height:20,width:200}),{xtype:"textarea",name:"jaminan_desc",id:"jaminan_descid",ref:"../jaminan_desc",maxLength:90,allowBlank:!1,readOnly:!0,height:"55",width:"400",x:100,y:122},{xtype:"label",text:"Season",x:540,y:125},new jun.cmbSeason({name:"season",ref:"../season",allowBlank:!1,readOnly:!0,x:660,y:122,height:20,width:200}),{xtype:"label",text:"Tanggal Pinjam",x:5,y:185},{xtype:"xdatefield",ref:"../tgl_pinjam",name:"tgl_pinjam",id:"tgl_pinjamid",format:"d M Y H:i",submitFormat:"Y-m-d H:i",allowBlank:!1,readOnly:!0,x:100,y:182,height:20,width:200},{xtype:"label",text:"Lama Sewa",x:340,y:185},{xtype:"spinnerfield",hideLabel:!1,name:"sewa_bln",id:"sewa_blnid",ref:"../sewa_bln",maxLength:2,minValue:0,maxValue:12,value:0,allowBlank:!1,readOnly:!0,x:410,y:182,height:20,width:50},{xtype:"label",text:"(bulan)",x:470,y:185},{xtype:"spinnerfield",hideLabel:!1,name:"sewa_hari",id:"sewa_hariid",ref:"../sewa_hari",maxLength:2,minValue:0,maxValue:31,value:0,allowBlank:!1,readOnly:!0,x:520,y:182,height:20,width:50},{xtype:"label",text:"(hari)",x:580,y:185},{xtype:"spinnerfield",hideLabel:!1,name:"sewa_jam",id:"sewa_jamid",ref:"../sewa_jam",maxLength:2,minValue:0,maxValue:12,value:0,incrementValue:12,allowBlank:!1,readOnly:!0,x:620,y:182,height:20,width:50},{xtype:"label",text:"(jam)",x:680,y:185},{xtype:"label",text:"Rencana Kembali",x:5,y:215},{xtype:"xdatefield",hideLabel:!1,format:"d M Y H:i",submitFormat:"Y-m-d H:i",name:"tgl_rencana_kembali",id:"tgl_rencana_kembali",maxLength:40,readOnly:!0,ref:"../rencana_tanggal_kembali",x:100,y:212,height:20,width:200},{xtype:"label",text:"Extend",x:340,y:215},{xtype:"spinnerfield",name:"extend_bln",id:"extend_blnid",ref:"../extend_bln",maxLength:2,minValue:0,maxValue:12,value:0,allowBlank:!1,readOnly:!0,x:410,y:212,height:20,width:50},{xtype:"label",text:"(bulan)",x:470,y:215},{xtype:"spinnerfield",hideLabel:!1,name:"extend_hari",id:"extend_hariid",ref:"../extend_hari",maxLength:2,minValue:0,maxValue:31,value:0,allowBlank:!1,readOnly:!0,x:520,y:212,height:20,width:50},{xtype:"label",text:"(hari)",x:580,y:215},{xtype:"spinnerfield",hideLabel:!1,name:"extend_jam",id:"extend_jamid",ref:"../extend_jam",maxLength:2,minValue:0,maxValue:12,value:0,incrementValue:12,allowBlank:!1,readOnly:!0,x:620,y:212,height:20,width:50},{xtype:"label",text:"(jam)",x:680,y:215},{xtype:"label",text:"Tanggal Kembali",x:5,y:245},{xtype:"xdatefield",hideLabel:!1,format:"d M Y H:i",submitFormat:"Y-m-d H:i",name:"tgl_kembali",id:"tgl_kembali",ref:"../tgl_kembali",allowBlank:!1,x:100,y:242,height:20,width:200},{xtype:"label",text:"Overtime",x:340,y:245},{xtype:"spinnerfield",hideLabel:!1,name:"overtime_jam",id:"overtime_jamid",ref:"../overtime_jam",maxLength:2,minValue:0,maxValue:12,value:0,allowBlank:!1,readOnly:!0,x:410,y:242,height:20,width:50},{xtype:"label",text:"(jam)",x:470,y:245},{xtype:"label",text:"ONGKOS SEWA",x:5,y:275},{xtype:"label",text:"Nama Driver",x:5,y:305},{xtype:"combo",typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",forceSelection:!0,lastQuery:"",store:jun.rztMtDriver,hiddenName:"id_driver",hiddenValue:"id_driver",valueField:"id_driver",displayField:"nama",allowBlank:!0,emptyText:"Non Driver",ref:"../driver",x:100,y:302,height:20,width:100},{xtype:"label",text:"No Polisi",x:5,y:335},{xtype:"combo",typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",allowBlank:!1,forceSelection:!0,lastQuery:"",store:jun.rztMtMobil,hiddenName:"id_mobil",hiddenValue:"id_mobil",valueField:"id_mobil",displayField:"nopol",ref:"../nopol",readOnly:!0,x:100,y:332,height:20,width:100},{xtype:"label",text:"Jenis Mobil",x:210,y:335},{xtype:"textfield",hideLabel:!1,name:"nopolisi",id:"nopolisi",readOnly:!0,ref:"../jenis_mobil",x:280,y:332,height:20,width:200},{xtype:"label",text:"Cara Bayar",x:5,y:365},new jun.comboPayment({fieldLabel:"Cara Bayar",value:"Tunai",name:"trans_via",ref:"../trans_via",x:100,y:362,height:20,width:100}),{xtype:"label",text:"Bukti Transfer",x:210,y:365},{xtype:"textfield",hideLabel:!1,name:"no_bukti_bayar",id:"no_bukti_bayarid",ref:"../no_bukti_bayar",maxLength:50,allowBlank:!1,x:290,y:362,height:20,width:150},{xtype:"label",text:"Catatan",x:5,y:395},{xtype:"textarea",name:"notes",id:"notesid",ref:"../notes",maxLength:225,allowBlank:!1,height:"110",width:"400",x:100,y:392},{xtype:"label",text:"Ongkos Sewa Mobil",x:540,y:245},{xtype:"numericfield",hideLabel:!1,name:"ongkos_sewa",id:"ongkos_sewaid",ref:"../ongkos_sewa",maxLength:30,readOnly:!0,value:0,x:660,y:242,height:20,width:200},{xtype:"label",text:"Ongkos Extend",x:540,y:275},{xtype:"numericfield",hideLabel:!1,name:"ongkos_extend",id:"ongkos_extendid",ref:"../ongkos_extend",readOnly:!0,maxLength:30,value:0,x:660,y:272,height:20,width:200},{xtype:"label",text:"Driver",x:540,y:305},{xtype:"numericfield",hideLabel:!1,name:"ongkos_driver",id:"ongkos_driverid",ref:"../ongkos_driver",maxLength:30,value:0,allowBlank:!1,x:660,y:302,height:20,width:200},{xtype:"label",text:"Bensin",x:540,y:335},{xtype:"numericfield",hideLabel:!1,name:"ongkos_bbm",id:"ongkos_bbmid",ref:"../ongkos_bbm",maxLength:30,value:0,allowBlank:!1,x:660,y:332,height:20,width:200},{xtype:"label",text:"Total Ongkos Sewa",x:540,y:365},{xtype:"numericfield",hideLabel:!1,name:"total_ongkos",id:"total_ongkosid",ref:"../total_ongkos",maxLength:30,readOnly:!0,value:0,x:660,y:362,height:20,width:200},{xtype:"label",text:"Diskon",x:540,y:395},{xtype:"numericfield",hideLabel:!1,name:"disc",id:"discid",ref:"../disc",maxLength:30,readOnly:!0,value:0,x:660,y:392,height:20,width:200},{xtype:"label",text:"Total All",x:540,y:425},{xtype:"numericfield",hideLabel:!1,name:"total",id:"total",ref:"../total",maxLength:30,readOnly:!0,value:0,x:660,y:422,height:20,width:200},{xtype:"label",text:"DP",x:540,y:455},{xtype:"numericfield",hideLabel:!1,name:"dp",id:"dpid",ref:"../dp",maxLength:30,value:0,allowBlank:!1,readOnly:!0,x:660,y:452,height:20,width:200},{xtype:"label",text:"Pelunasan",x:540,y:485},{xtype:"numericfield",hideLabel:!1,name:"pelunasan",id:"pelunasanid",ref:"../pelunasan",readOnly:!0,value:0,x:660,y:482,height:20,width:200}]}],this.fbar={xtype:"toolbar",items:[{xtype:"button",text:"Simpan",hidden:!1,ref:"../btnSave"},{xtype:"button",text:"Simpan & Tutup",ref:"../btnSaveClose"},{xtype:"button",text:"Tutup",ref:"../btnCancel"}]},jun.MtPengembalianWin.superclass.initComponent.call(this),this.on("activate",this.onActivate,this),this.btnSaveClose.on("click",this.onbtnSaveCloseClick,this),this.btnSave.on("click",this.onbtnSaveclick,this),this.btnCancel.on("click",this.onbtnCancelclick,this),this.tgl_kembali.on("change",this.onDurationChange,this),this.ongkos_driver.on("change",this.onDurationChange,this),this.ongkos_bbm.on("change",this.onDurationChange,this),this.driver.on("change",this.onDriverChange,this),this.ongkos_driver.on("change",this.onDriverChange,this),this.ongkos_bbm.on("change",this.calculateTotal,this)},onDriverChange:function(){if(this.driver.getValue()===""||this.driver.getValue()===null)this.ongkos_driver.setValue(0);else{var a=parseFloat(this.ongkos_driver.getValue());a<75e3&&this.ongkos_driver.setValue(75e3)}this.calculateTotal()},calculateTotal:function(){var a=this.nopol.getValue(),b=this.id_kelompok.getValue(),c=this.extend_bln.getValue(),d=this.extend_hari.getValue(),e=this.extend_jam.getValue(),f=this.overtime_jam.getValue(),g=parseFloat(this.ongkos_sewa.getValue()),h=parseFloat(this.season.getValue());if(a===""||b==="")return;var i=jun.getMobil(a),j=jun.getKelompokPelanggan(b),k=jun.getMtSysPrefs("kelompok_other_rental"),l=j.data.id_kelompok===k.data.value,m=l?0:parseFloat(j.data.discont_persen)*.01,n=l?parseFloat(i.data.other_tarif_12):parseFloat(i.data.tarif_12),o=l?parseFloat(i.data.other_tarif_high_12):parseFloat(i.data.tarif_high_12),p=l?parseFloat(i.data.other_tarif_24):parseFloat(i.data.tarif_24),q=l?parseFloat(i.data.other_tarif_high_24):parseFloat(i.data.tarif_high_24),r=l?parseFloat(i.data.other_tarif_bulanan):parseFloat(i.data.tarif_bulanan),s=l?parseFloat(i.data.other_overtime):parseFloat(i.data.overtime),t=s*.01,u=h===0?p:q,v=h===0?n:o,w=r*parseFloat(c),x=u*parseFloat(d),y=parseFloat(e)>0?v:0,z=u*t*parseFloat(f),A=w+x+y+z;this.ongkos_extend.setValue(A);var B=parseFloat(this.ongkos_driver.getValue()),C=parseFloat(this.ongkos_bbm.getValue()),D=A+g+B+C;this.total_ongkos.setValue(D);var E=D*m;this.disc.setValue(E);var F=D-E;this.total.setValue(F);var G=parseFloat(this.dp.getValue());this.pelunasan.setValue(F-G)},onDurationChange:function(){var a=this.tgl_pinjam.getValue(),b=this.rencana_tanggal_kembali.getValue(),c=this.tgl_kembali.getValue();if(c==="")return;c.between(a,b)&&(c=b),Ext.Ajax.request({url:"Mahkotrans/mtKembaliKendaraan/DateDiff",params:{tgl_rencana:b.format("Y-m-d H:i:s"),tgl_kembali:c.format("Y-m-d H:i:s")},method:"POST",scope:this,success:function(a,b){var c=Ext.decode(a.responseText);if(c.status===!0){var d=parseInt(c.msg.Months),e=parseInt(c.msg.Days),f=parseInt(c.msg.Hours),g=0,h=0;f>=12?(g=12,h=f-12):h=f,Ext.getCmp("extend_blnid").setValue(d),Ext.getCmp("extend_hariid").setValue(e),Ext.getCmp("extend_jamid").setValue(g),Ext.getCmp("overtime_jamid").setValue(h),this.calculateTotal()}},failure:function(a,b){this.btnDisabled(!1);if(b.failureType=="client")return;Ext.MessageBox.alert("Error","Can't Communicate With The Server")}})},btnDisabled:function(a){this.btnSave.setDisabled(a),this.btnSaveClose.setDisabled(a)},onActivate:function(){this.modez===0?(this.btnSave.show(),this.btnSaveClose.show()):(this.btnSave.hide(),this.btnSaveClose.hide())},saveForm:function(){this.btnDisabled(!0);var a;a="Mahkotrans/MtKembaliKendaraan/create",Ext.getCmp("from-MtPengembalianWin").getForm().submit({url:a,timeOut:1e3,scope:this,success:function(a,b){var c=Ext.decode(b.response.responseText);if(c.success==0){Ext.MessageBox.show({title:"Peminjaman Kendaraan",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR}),this.btnDisabled(!1);return}Ext.MessageBox.show({title:"Peminjaman Kendaraan",msg:c.msg+"<br /> Ref. Dokumen : "+c.id,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO}),Ext.getCmp("from-MtPengembalianWin").getForm().reset(),jun.rztMtPinjamKendaraan.reload(),this.btnDisabled(!1),this.close()},failure:function(a,b){this.btnDisabled(!1);if(b.failureType=="client")return;Ext.MessageBox.alert("Error","Can't Communicate With The Server")}})},onbtnSaveCloseClick:function(){this.closeForm=!0,this.saveForm(!0)},onbtnSaveclick:function(){this.closeForm=!1,this.saveForm(!1)},onbtnCancelclick:function(){this.close()}}),jun.MtKembaliVoidWin=Ext.extend(Ext.Window,{title:"Void Pengembalian",modez:1,width:300,height:150,layout:"form",modal:!0,padding:5,closeForm:!1,initComponent:function(){this.items=[{xtype:"form",frame:!1,bodyStyle:"background-color: #E4E4E4; padding: 10px",id:"form-MtKembaliVoid",layout:"absolute",ref:"formz",border:!1,anchor:"100% 100%",items:[{xtype:"label",text:"Alasan Void : ",x:5,y:5,width:100},{xtype:"textarea",fieldLabel:"memo",ref:"../memo",id:"memo_id",name:"memo_",x:5,y:25,anchor:"100% 100%"}]}],this.fbar={xtype:"toolbar",items:[{xtype:"button",text:"Proses",ref:"../btnProses"},{xtype:"button",text:"Batal",ref:"../btnCancel"}]},jun.MtKembaliVoidWin.superclass.initComponent.call(this),this.btnProses.on("click",this.onbtnProsesclick,this),this.btnCancel.on("click",this.onbtnCancelclick,this)},btnDisabled:function(a){this.btnProses.setDisabled(a)},onbtnProsesclick:function(){this.btnDisabled(!0);var a=Ext.getCmp("form-MtKembaliVoid").getForm();Ext.getCmp("form-MtKembaliVoid").getForm().submit({url:"Mahkotrans/mtKembaliKendaraan/delete",params:{id:this.id},method:"POST",scope:this,timeOut:1e3,success:function(a,b){var c=Ext.decode(b.response.responseText);if(c.success==0){Ext.MessageBox.show({title:"Pengembalian Kendaraan",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}Ext.MessageBox.show({title:"Pengembalian Kendaraan",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO}),Ext.getCmp("form-MtKembaliVoid").getForm().reset(),this.btnDisabled(!1),jun.rztMtKembaliKendaraan.reload(),this.close()},failure:function(a,b){this.btnDisabled(!1);if(b.failureType=="client")return;Ext.MessageBox.alert("error","could not connect to the database. retry later")}})},onbtnCancelclick:function(){this.close()}});